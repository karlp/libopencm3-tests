source [find interface/stlink.cfg]

set WORKAREASIZE 0x2000
source [find target/stm32l1.cfg]

# f072rb nucleo64 on karl's desk
#hla_serial 0672FF504955857567112610
#hla_serial "0671FF535651727067172912"; #  chopped nucleo on my desk
# karl's l1 disco board
#hla_serial 53FF6D064882575140271187

bindto 0.0.0.0

#tpiu config internal :3443 uart off 32000000
#tpiu config internal /tmp/hate uart off 32000000
#tpiu config internal swo.dump.log uart off 32000000
#source [find ../trace-helpers.cfg]

$_TARGETNAME configure -rtos FreeRTOS

# Uncomment to reset on connect, for grabbing under WFI et al
reset_config srst_only srst_nogate
#reset_config srst_only srst_nogate connect_assert_srst

# Paul Fertser's code for clearing eeprom on l1
proc unlock_eeprom { } {
    init
    reset init
    mww [expr 0x40000000 + 0x20000 + 0x3C00 + 0xC] 0x89ABCDEF
    mww [expr 0x40000000 + 0x20000 + 0x3C00 + 0xC] 0x02030405
}

proc erase_eep { } {
	unlock_eeprom
	mww 0x08080000 0
	mww 0x08080040 0
}

proc erase_eepc { } {
	unlock_eeprom
	mww 0x08080000 0
}

proc erase_eepx { } {
	unlock_eeprom
	mww 0x08080040 0
}
